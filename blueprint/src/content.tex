\chapter{Introduction}

This blueprint documents the formalization of Ricci Flow theory in Lean 4.
Ricci Flow is a fundamental geometric evolution equation introduced by Richard Hamilton,
which has profound applications including Perelman's proof of the Poincaré conjecture.

\chapter{Basic Lemmas}
\label{chap:basic}

This chapter contains fundamental lemmas about real numbers and topology.

\begin{lemma}[Positive Multiplication]
\label{lem:pos_mul_pos}
\lean{RicciFlow.pos_mul_pos}
\leanok
For positive real numbers $a > 0$ and $b > 0$, their product $a \cdot b > 0$.
\end{lemma}

\begin{proof}
\leanok
Direct application of Mathlib's \texttt{mul\_pos}.
\end{proof}

\begin{lemma}[Square Positive of Nonzero]
\label{lem:square_pos_of_ne_zero}
\lean{RicciFlow.square_pos_of_ne_zero}
\leanok
For any nonzero real number $x \neq 0$, we have $x^2 > 0$.
\end{lemma}

\begin{proof}
\leanok
Uses \texttt{sq\_pos\_of\_ne\_zero} from Mathlib.
\end{proof}

\begin{lemma}[Existence of Positive Real]
\label{lem:exists_pos_real}
\lean{RicciFlow.exists_pos_real}
\leanok
There exists a positive real number.
\end{lemma}

\begin{proof}
\leanok
We construct $1$ as a witness.
\end{proof}

\begin{lemma}[Inverse Positive of Positive]
\label{lem:inv_pos_of_pos}
\lean{RicciFlow.inv_pos_of_pos}
\leanok
For $x > 0$, we have $x^{-1} > 0$.
\end{lemma}

\begin{proof}
\leanok
Uses \texttt{inv\_pos} from Mathlib.
\end{proof}

\begin{lemma}[Continuous At iff Continuous Within At]
\label{lem:continuousAt_iff}
\lean{RicciFlow.continuousAt_iff_continuousWithinAt}
\leanok
Continuity at a point is equivalent to continuity within the universal set.
\end{lemma}

\begin{proof}
\leanok
Uses \texttt{continuousWithinAt\_univ} from Mathlib.
\end{proof}

\chapter{Riemannian Manifolds}
\label{chap:riemannian}

\begin{definition}[Riemannian Metric]
\label{def:riemannian_metric}
\lean{RicciFlow.RiemannianMetric}
\leanok
\uses{lem:pos_mul_pos, lem:square_pos_of_ne_zero}
A Riemannian metric on a manifold $M$ is a smooth positive-definite symmetric bilinear form on each tangent space.

For each point $x \in M$ and tangent vectors $v, w \in T_xM$:
\begin{itemize}
\item \textbf{Symmetry}: $g_x(v, w) = g_x(w, v)$
\item \textbf{Positive-definiteness}: $g_x(v, v) > 0$ for all $v \neq 0$
\end{itemize}
\end{definition}

\begin{definition}[Inner Product]
\label{def:inner_product}
\lean{RicciFlow.innerProduct}
\leanok
\uses{def:riemannian_metric}
The inner product of tangent vectors $v, w \in T_xM$ is defined as $\langle v, w \rangle_x = g_x(v, w)$.
\end{definition}

\begin{definition}[Norm Squared]
\label{def:norm_sq}
\lean{RicciFlow.normSq}
\leanok
\uses{def:riemannian_metric}
The squared norm of a tangent vector $v \in T_xM$ is $\|v\|^2 = g_x(v, v)$.
\end{definition}

\begin{lemma}[Inner Product Symmetry]
\label{lem:inner_product_symm}
\lean{RicciFlow.innerProduct_symm}
\leanok
\uses{def:inner_product}
For any tangent vectors $v, w$ at point $x$: $\langle v, w \rangle_x = \langle w, v \rangle_x$.
\end{lemma}

\begin{proof}
\leanok
\uses{def:riemannian_metric}
Follows from the symmetry axiom of the Riemannian metric.
\end{proof}

\begin{lemma}[Norm Squared Positivity]
\label{lem:norm_sq_pos}
\lean{RicciFlow.normSq_pos}
\leanok
\uses{def:norm_sq}
For any nonzero tangent vector $v$ at point $x$: $\|v\|^2 > 0$.
\end{lemma}

\begin{proof}
\leanok
\uses{def:riemannian_metric}
Follows from the positive-definiteness axiom.
\end{proof}

\chapter{Ricci Curvature}
\label{chap:ricci}

\begin{definition}[Metric Velocity]
\label{def:metric_velocity}
\lean{RicciFlow.MetricVelocity}
\leanok
\uses{def:riemannian_metric}
A metric velocity is an abstract symmetric $(0,2)$-tensor field used to represent time derivatives of metrics and the Ricci tensor.

For each point $x \in M$ and tangent vectors $v, w \in T_xM$:
\begin{itemize}
\item $\tau_x : T_xM \times T_xM \to \mathbb{R}$ is a bilinear form
\item \textbf{Symmetry}: $\tau_x(v, w) = \tau_x(w, v)$
\end{itemize}

The space of metric velocities admits scalar multiplication: for $c \in \mathbb{R}$ and velocity $\tau$, we have $(c \cdot \tau)_x(v,w) = c \cdot \tau_x(v,w)$.
\end{definition}

\begin{definition}[Ricci of Metric]
\label{def:ricci_of_metric}
\lean{RicciFlow.ricciOfMetric}
\uses{def:riemannian_metric, def:metric_velocity}
The Ricci operator $\mathrm{Ric} : g \mapsto \mathrm{Ric}(g)$ assigns to each Riemannian metric a metric velocity representing the Ricci curvature tensor.

Mathematically, the Ricci tensor is obtained by contracting the Riemann curvature tensor:
\[ \mathrm{Ric}_{ij} = R^k_{ikj} = g^{kl} R_{likj} \]

This is currently axiomatized; a complete implementation would compute it from the metric via Christoffel symbols and the Riemann tensor.
\end{definition}

\begin{definition}[Ricci Tensor (Legacy)]
\label{def:ricci_tensor}
\lean{RicciFlow.RicciTensor}
\leanok
\uses{def:metric_velocity}
For compatibility, we retain a simplified \texttt{RicciTensor} structure storing only the scalar curvature. The PDE interface uses \texttt{MetricVelocity} instead.
\end{definition}

\begin{definition}[Scalar Curvature]
\label{def:scalar_curvature}
\lean{RicciFlow.scalarCurvature}
\leanok
\uses{def:ricci_tensor, lem:inv_pos_of_pos}
The scalar curvature is the trace of the Ricci tensor: $R = g^{ij} \mathrm{Ric}_{ij}$.

\textbf{Geometric meaning}:
\begin{itemize}
\item $R > 0$: positive curvature (sphere-like)
\item $R < 0$: negative curvature (hyperbolic)
\item $R = 0$: flat (Euclidean)
\end{itemize}
\end{definition}

\begin{lemma}[Scalar Curvature Computation]
\label{lem:scalar_curvature_eq}
\lean{RicciFlow.scalarCurvature_eq_traceValue}
\leanok
\uses{def:scalar_curvature}
The scalar curvature equals the trace value: $R = \mathrm{Ric}.\mathrm{traceValue}$.
\end{lemma}

\begin{proof}
\leanok
Definitional in our current implementation.
\end{proof}

\chapter{Ricci Flow}
\label{chap:flow}

\begin{definition}[Time Derivative]
\label{def:time_deriv}
\lean{RicciFlow.timeDeriv}
\uses{def:riemannian_metric, def:metric_velocity}
For a time-dependent family of Riemannian metrics $g : \mathbb{R} \to \mathrm{Met}(M)$, the time derivative at time $t$ is a metric velocity:
\[ \frac{\partial g}{\partial t}\Big|_t : T_xM \times T_xM \to \mathbb{R} \]

This is currently axiomatized; a complete implementation would use the Fr\'echet derivative in an appropriate function space.
\end{definition}

\begin{definition}[Ricci Flow Equation On Set]
\label{def:ricci_flow_eq_on}
\lean{RicciFlow.ricciFlowEqOn}
\leanok
\uses{def:time_deriv, def:ricci_of_metric}
A family of metrics $g(t)$ satisfies the Ricci flow equation on a time interval $S \subseteq \mathbb{R}$ if:
\[ \forall t \in S, \quad \frac{\partial g}{\partial t}\Big|_t = -2 \, \mathrm{Ric}(g(t)) \]

In Lean: \texttt{ricciFlowEqOn g S} means $\forall t \in S$, \texttt{timeDeriv g t = (-2) $\cdot$ ricciOfMetric (g t)}.

This PDE deforms the metric to make the curvature more uniform over time.
\end{definition}

\begin{theorem}[Hamilton Short-Time Existence (Axiomatized)]
\label{axiom:hamilton_ste}
\lean{RicciFlow.hamilton_short_time_existence}
\uses{def:ricci_flow_eq_on, lem:exists_pos_real}
For any smooth compact Riemannian manifold $(M, g_0)$, there exists $T > 0$ and a smooth family $g : \mathbb{R} \to \mathrm{Met}(M)$ such that:
\begin{itemize}
\item $g(0) = g_0$ (initial condition)
\item $g(t)$ satisfies the Ricci flow equation for $t \in (0, T)$
\end{itemize}
\end{theorem}

\begin{proof}
This axiomatizes Hamilton's fundamental theorem (1982). The complete proof involves DeTurck's trick and parabolic PDE theory.
\end{proof}

\begin{theorem}[Short-Time Existence]
\label{thm:short_time_existence}
\lean{RicciFlow.short_time_existence}
\leanok
\uses{axiom:hamilton_ste}
For any smooth compact Riemannian manifold $(M, g_0)$, there exists $T > 0$ and a smooth solution $g(t)$ to the Ricci flow for $t \in (0, T)$ with initial condition $g(0) = g_0$.
\end{theorem}

\begin{proof}
\leanok
Direct application of the Hamilton axiom.
\end{proof}

\chapter{Pullback Structures and DeTurck Reduction}
\label{chap:deturck}

\providecommand{\lean}[1]{\texttt{#1}}

This chapter presents the pullback operation on tensor fields and the DeTurck reduction technique, which decomposes Hamilton's short-time existence into modular, provable components.

\section{Pullback Structures}

\begin{definition}[Pullback of Metric Velocity]
\label{def:pullback_velocity}
\lean{RicciFlow.pullbackVelocity}
\leanok
\uses{def:metric_velocity}
For a map $\varphi : M \to M$ and a metric velocity $\tau$, the pullback $\varphi^*\tau$ is defined by basepoint reindexing:
\[ (\varphi^*\tau)_x(v,w) = \tau_{\varphi(x)}(v,w) \]

In our minimal model, the fiber $V$ is fixed, so pullback acts pointwise on $x \mapsto \tau(\varphi(x), \cdot, \cdot)$. This preserves symmetry and supports linear operations.

\textbf{File}: \texttt{Geometry/Pullback.lean}
\end{definition}

\begin{definition}[Pullback of Riemannian Metric]
\label{def:pullback_metric}
\lean{RicciFlow.pullbackMetric}
\leanok
\uses{def:riemannian_metric}
For a map $\varphi : M \to M$ and a Riemannian metric $g$, the pullback $\varphi^*g$ is defined by:
\[ (\varphi^*g)_x(v,w) = g_{\varphi(x)}(v,w) \]

This preserves symmetry and positive-definiteness by evaluation at $\varphi(x)$.

\textbf{File}: \texttt{Geometry/Pullback.lean}
\end{definition}

\begin{lemma}[Linearity of Pullback]
\label{lem:pullback_linearity}
\lean{RicciFlow.pullbackVelocity_zero, RicciFlow.pullbackVelocity_add, RicciFlow.pullbackVelocity_smul, RicciFlow.pullbackVelocity_neg}
\leanok
\uses{def:pullback_velocity}
The pullback operation is linear in velocities:
\begin{itemize}
\item $\varphi^*0 = 0$ (preserves zero)
\item $\varphi^*(\tau + \sigma) = \varphi^*\tau + \varphi^*\sigma$ (preserves addition)
\item $\varphi^*(c \cdot \tau) = c \cdot (\varphi^*\tau)$ for $c \in \mathbb{R}$ (preserves scalar multiplication)
\item $\varphi^*(-\tau) = -(\varphi^*\tau)$ (preserves negation)
\end{itemize}
\end{lemma}

\begin{proof}
\leanok
All properties follow immediately from the pointwise definition. For example, $\varphi^*0$ is zero because $(\varphi^*0)_x(v,w) = 0_{\varphi(x)}(v,w) = 0$ for all $x, v, w$. The other properties are similar.
\end{proof}

\begin{lemma}[Functoriality of Pullback]
\label{lem:pullback_functoriality}
\lean{RicciFlow.pullbackMetric_id, RicciFlow.pullbackMetric_comp}
\leanok
\uses{def:pullback_metric, def:pullback_velocity}
Pullback satisfies functorial properties:
\begin{itemize}
\item $\mathrm{id}^* = \mathrm{id}$ (identity)
\item $(\varphi \circ \psi)^* = \psi^* \circ \varphi^*$ (composition)
\end{itemize}
\end{lemma}

\begin{proof}
\leanok
Direct verification from the definition.
\end{proof}

\section{DeTurck--Hamilton Reduction (Conditional)}

\begin{definition}[DeTurck Equation with Gauge]
\label{def:deturckEqOnWithGauge}
\lean{RicciFlow.deturckEqOnWithGauge}
\uses{def:time_deriv, def:ricci_of_metric, def:metric_velocity}
A family of metrics $g(t)$ satisfies the DeTurck equation with gauge velocity $G(t)$ on a time interval $S$ if:
\[ \forall t \in S, \quad \frac{\partial g}{\partial t}\Big|_t = -2 \, \mathrm{Ric}(g(t)) + G(t) \]

The gauge term $G(t)$ represents an abstract ``gauge-fixing'' velocity that will be compensated by a suitable diffeomorphism flow.

\textbf{File}: \texttt{Ricci/DeturckReduction.lean}
\end{definition}

\begin{definition}[Pullback Chain Rule]
\label{def:pullbackChainRuleOn}
\lean{RicciFlow.pullbackChainRuleOn}
\uses{def:pullback_metric, def:time_deriv}
For a time-dependent diffeomorphism $\varphi_t : M \to M$ and metric family $g(t)$, the chain rule holds on $S$ if:
\[ \forall t \in S, \quad \frac{\partial}{\partial t}(\varphi_t^* g(t)) = \varphi_t^*\left(\frac{\partial g}{\partial t}\right) + \frac{\partial \varphi_t^*}{\partial t}g(t) \]

This expresses the time derivative of a pulled-back metric as the sum of the pulled-back time derivative and the ``$\varphi$-part'' contribution.

\textbf{File}: \texttt{Ricci/DeturckReduction.lean}
\end{definition}

\begin{definition}[Gauge Cancellation]
\label{def:gaugeCancellationOn}
\lean{RicciFlow.gaugeCancellationOn}
\uses{def:pullback_velocity}
The diffeomorphism flow $\varphi_t$ achieves gauge cancellation on $S$ if:
\[ \forall t \in S, \quad \frac{\partial \varphi_t^*}{\partial t}g(t) = -\varphi_t^* G(t) \]

This means the ``$\varphi$-part'' exactly cancels the pulled-back gauge term.

\textbf{File}: \texttt{Ricci/DeturckReduction.lean}
\end{definition}

\begin{definition}[Ricci Naturality]
\label{def:ricciNaturalityOn}
\lean{RicciFlow.ricciNaturalityOn}
\uses{def:ricci_of_metric, def:pullback_metric}
The Ricci operator commutes with pullback on $S$ if:
\[ \forall t \in S, \quad \mathrm{Ric}(\varphi_t^* g(t)) = \varphi_t^* \mathrm{Ric}(g(t)) \]

This is a naturality property expressing that Ricci curvature is geometric and invariant under pullback.

\textbf{File}: \texttt{Ricci/DeturckReduction.lean}
\end{definition}

\begin{theorem}[DeTurck to Hamilton Reduction]
\label{thm:deturck_to_hamilton}
\lean{RicciFlow.deturck_to_hamilton_reduction}
\leanok
\uses{def:deturckEqOnWithGauge, def:pullbackChainRuleOn, def:gaugeCancellationOn, def:ricciNaturalityOn}
Suppose on a time interval $S$:
\begin{enumerate}
\item $g(t)$ satisfies the DeTurck equation with gauge $G(t)$ (\ref{def:deturckEqOnWithGauge})
\item The pullback chain rule holds (\ref{def:pullbackChainRuleOn})
\item Gauge cancellation holds (\ref{def:gaugeCancellationOn})
\item Ricci naturality holds (\ref{def:ricciNaturalityOn})
\end{enumerate}

Then $\hat{g}(t) := \varphi_t^* g(t)$ satisfies Hamilton's Ricci flow equation on $S$:
\[ \forall t \in S, \quad \frac{\partial \hat{g}}{\partial t}\Big|_t = -2 \, \mathrm{Ric}(\hat{g}(t)) \]
\end{theorem}

\begin{proof}
\leanok
Differentiate $\varphi_t^* g(t)$ using the chain rule to split into the pulled-back time derivative plus the $\varphi$-part:
\[ \frac{\partial}{\partial t}(\varphi_t^* g(t)) = \varphi_t^*\left(\frac{\partial g}{\partial t}\right) + \frac{\partial \varphi_t^*}{\partial t}g(t) \]

Substitute the DeTurck equation for $\partial g/\partial t$:
\[ = \varphi_t^*\big(-2\,\mathrm{Ric}(g(t)) + G(t)\big) + \frac{\partial \varphi_t^*}{\partial t}g(t) \]

Use linearity of pullback to expand:
\[ = -2\,\varphi_t^*\mathrm{Ric}(g(t)) + \varphi_t^* G(t) + \frac{\partial \varphi_t^*}{\partial t}g(t) \]

Apply gauge cancellation to eliminate the last two terms:
\[ = -2\,\varphi_t^*\mathrm{Ric}(g(t)) \]

Finally, use Ricci naturality:
\[ = -2\,\mathrm{Ric}(\varphi_t^* g(t)) = -2\,\mathrm{Ric}(\hat{g}(t)) \]

This completes the proof.

\textbf{File}: \texttt{Ricci/DeturckReduction.lean}
\end{proof}

\section{Toy Corollaries for Sanity Checks}

\begin{lemma}[Chain Rule for Constant Diffeomorphism]
\label{lem:pullbackChainRuleOn_constφ}
\lean{RicciFlow.pullbackChainRuleOn_constφ}
\leanok
\uses{def:pullbackChainRuleOn}
If $\varphi_t \equiv \varphi_0$ is constant in time, then the chain rule (\ref{def:pullbackChainRuleOn}) holds automatically: the ``$\varphi$-part'' vanishes, so
\[ \frac{\partial}{\partial t}(\varphi_0^* g(t)) = \varphi_0^*\left(\frac{\partial g}{\partial t}\right) \]
\end{lemma}

\begin{proof}
\leanok
When $\varphi_t$ is constant, $\partial \varphi_t^*/\partial t = 0$. The chain rule reduces to the statement that pullback commutes with time differentiation, which is immediate from the definition.

\textbf{File}: \texttt{Ricci/DeturckReduction.lean}
\end{proof}

\begin{corollary}[DeTurck to Hamilton with Constant Diffeomorphism]
\label{cor:deturck_to_hamilton_constφ_noGauge}
\lean{RicciFlow.deturck_to_hamilton_constφ_noGauge}
\leanok
\uses{thm:deturck_to_hamilton, lem:pullbackChainRuleOn_constφ}
If $\varphi_t \equiv \varphi_0$ is constant and $G \equiv 0$, and if $g(t)$ satisfies
\[ \frac{\partial g}{\partial t} = -2\,\mathrm{Ric}(g(t)) \]
with Ricci naturality under $\varphi_0$, then $\hat{g}(t) := \varphi_0^* g(t)$ also satisfies Hamilton's Ricci flow.
\end{corollary}

\begin{proof}
\leanok
This is a direct application of Theorem~\ref{thm:deturck_to_hamilton} with the constant chain rule (Lemma~\ref{lem:pullbackChainRuleOn_constφ}) and trivial gauge cancellation (since $G \equiv 0$).

This corollary demonstrates the reduction mechanism in a controlled, provable setting without additional axioms.

\textbf{File}: \texttt{Ricci/DeturckReduction.lean}
\end{proof}

\section{Changelog: New Symbols and Files}

This chapter introduces the following new symbols and files:
\begin{itemize}
\item \texttt{RicciFlow/Geometry/Pullback.lean}: Defines \texttt{pullbackVelocity}, \texttt{pullbackMetric}, and proves linearity/functoriality lemmas.
\item \texttt{RicciFlow/Ricci/DeturckReduction.lean}: Defines the four conditional predicates (\texttt{deturckEqOnWithGauge}, \texttt{pullbackChainRuleOn}, \texttt{gaugeCancellationOn}, \texttt{ricciNaturalityOn}), proves the main reduction theorem \texttt{deturck\_to\_hamilton\_reduction}, and adds two toy lemmas for sanity checking.
\item No new axioms were introduced. The reduction theorem is conditional on four geometric/analytic properties that are placeholders for future formalization.
\end{itemize}

\chapter{Future Directions}

\section{Planned Extensions}

\begin{itemize}
\item Prove the four DeTurck predicates in specific settings (e.g., Euclidean space, coordinate charts)
\item Complete formalization of short-time existence via parabolic PDE theory
\item Maximum principles for Ricci flow
\item Normalized Ricci flow
\item Perelman's monotonicity formulas
\item Convergence results
\end{itemize}

\section{Technical Improvements}

\begin{itemize}
\item Full tangent bundle implementation
\item Complete Riemann tensor computation from Christoffel symbols
\item Time-dependent Riemannian metrics with proper function space structure
\item Manifold calculus infrastructure (Lie derivatives, covariant derivatives)
\end{itemize}
